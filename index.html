<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Markerless AR Parabola Realistis</title>
  <script src="https://aframe.io/releases/1.4.1/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/aframe-extras@6.1.1/dist/aframe-extras.min.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js/aframe/build/aframe-ar-nft.js"></script>
  <style>
    body { margin:0; overflow:hidden; font-family:sans-serif; }
    #controls {
      position: fixed;
      top: 10px; left: 10px;
      background: rgba(255,255,255,0.9);
      padding: 10px; border-radius: 8px;
      z-index: 999;
      width: 220px;
    }
    #controls label { display:block; margin-top:5px; font-size:14px; }
    #controls input { width:100%; }
  </style>
</head>
<body>

<div id="controls">
  <label>Kecepatan awal (m/s): <span id="v0Val">3</span></label>
  <input type="range" id="v0" min="1" max="10" step="0.1" value="3">

  <label>Sudut peluncuran (°): <span id="angleVal">60</span></label>
  <input type="range" id="angle" min="10" max="80" step="1" value="60">

  <label>Gravitasi (m/s²): <span id="gVal">9.8</span></label>
  <input type="range" id="g" min="1" max="20" step="0.1" value="9.8">

  <button id="resetBtn">Reset Simulasi</button>
  <p id="stats"></p>
</div>

<a-scene
  embedded
  vr-mode-ui="enabled: false"
  renderer="antialias: true; colorManagement: true;"
  arjs="trackingMethod: best; sourceType: webcam; debugUIEnabled:false;">
  
  <!-- Markerless plane -->
  <a-entity id="floor" geometry="primitive: plane; width: 10; height: 10" material="visible: false" rotation="-90 0 0" position="0 0 0"></a-entity>
  <a-sphere id="ball" radius="0.05" color="red" position="0 0.05 0"></a-sphere>

  <a-entity camera look-controls></a-entity>
  <a-light type="directional" intensity="1" position="0 5 0"></a-light>
</a-scene>

<script>
  let v0 = 3, angle = 60, g = 9.8;
  let t = 0, dt = 0.05;
  let originSet = false;
  const ball = document.getElementById('ball');
  const stats = document.getElementById('stats');
  const floor = document.getElementById('floor');

  const v0Slider = document.getElementById('v0');
  const angleSlider = document.getElementById('angle');
  const gSlider = document.getElementById('g');
  const v0Val = document.getElementById('v0Val');
  const angleVal = document.getElementById('angleVal');
  const gVal = document.getElementById('gVal');
  const resetBtn = document.getElementById('resetBtn');

  function updateStats() {
    const rad = angle * Math.PI/180;
    const t_max = (2*v0*Math.sin(rad))/g;
    const x_max = v0*Math.cos(rad)*t_max;
    const y_max = (v0*Math.sin(rad))**2/(2*g);
    stats.innerHTML = `Tinggi maksimum: ${y_max.toFixed(2)} m<br>Jangkauan: ${x_max.toFixed(2)} m`;
  }

  resetBtn.addEventListener('click', ()=>{ t=0; originSet=false; updateStats(); });
  v0Slider.addEventListener('input', ()=>{ v0=parseFloat(v0Slider.value); v0Val.innerText=v0; t=0; originSet=false; });
  angleSlider.addEventListener('input', ()=>{ angle=parseFloat(angleSlider.value); angleVal.innerText=angle; t=0; originSet=false; });
  gSlider.addEventListener('input', ()=>{ g=parseFloat(gSlider.value); gVal.innerText=g; t=0; originSet=false; });

  // Tap untuk menetapkan titik awal di lantai
  document.body.addEventListener('click', (evt)=>{
    if(!originSet){
      const camera = document.querySelector('[camera]');
      const camPos = camera.object3D.position;
      ball.object3D.position.set(camPos.x, 0.05, camPos.z - 0.5); // 0.5 m depan kamera
      originSet = true;
      t = 0;
    }
  });

  function animate(){
    requestAnimationFrame(animate);
    if(originSet){
      t += dt;
      const rad = angle*Math.PI/180;
      const vx = v0*Math.cos(rad);
      const vy = v0*Math.sin(rad);
      const pos = ball.object3D.position;
      // update posisi parabola
      pos.x += vx*dt;
      pos.y = vy*t - 0.5*g*t*t + 0.05; // tinggi awal 0.05 m
      // berhenti jika menyentuh lantai
      if(pos.y < 0.05){ t=0; originSet=false; pos.y=0.05; }
      ball.object3D.position.set(pos.x, pos.y, pos.z);
      updateStats();
    }
  }
  animate();
</script>
</body>
</html>
